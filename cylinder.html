<!DOCTYPE html>
<html>
<head>
    <title>Welcome to WebGL</title>

    <link rel="stylesheet" href="../css/webglbook.css" />
    <script src="three.min.js"></script>
    <script src="RequestAnimationFrame.js"></script>
    <script>

        var renderer = null,
            scene = null,
            camera = null,
            cube = null,
            animating = false,
            yrot = false;

        function onLoad()
        {
            // Grab our container div
            var container = document.getElementById("container");

            // Create the Three.js renderer, add it to our div
            renderer = new THREE.WebGLRenderer( { antialias: true } );
            renderer.setSize(container.offsetWidth, container.offsetHeight);
            container.appendChild( renderer.domElement );

            // Create a new Three.js scene
            scene = new THREE.Scene();

            // Put in a camera
            camera = new THREE.PerspectiveCamera( 45, container.offsetWidth / container.offsetHeight, 1, 4000 );
            camera.position.set( 0, 0, 5 );

            // Create a directional light to show off the object
            var light = new THREE.DirectionalLight( 0xffffff, 1.5);
            light.position.set(0, 0, 1);
            scene.add( light );

            // Create a colored cube and add it to the scene

            // First, create a MeshFaceMaterial for coloring each face
            var mats = [];
            mats.push(new THREE.MeshBasicMaterial({ color: 0x009e60  }));
            mats.push(new THREE.MeshBasicMaterial({ color: 0x0051ba  }));
            mats.push(new THREE.MeshBasicMaterial({ color: 0xffd500  }));
            mats.push(new THREE.MeshBasicMaterial({ color: 0xff5800  }));
            mats.push(new THREE.MeshBasicMaterial({ color: 0xC41E3A }));
            mats.push(new THREE.MeshBasicMaterial({ color: 0xffffff  }));
            var faceMaterial = new THREE.MeshFaceMaterial(mats);


            // Create the cube geometry by hand

            var geometry = new THREE.Geometry();
            //Annahme: m = 2
            var n = 16;
            var radius = 1;
            var top = new THREE.Vector3(0,0,0);
            var bottom = new THREE.Vector3(0,0,2);
            drawCirclePoints(n, radius, top, geometry);
            drawCirclePoints(n, radius, bottom, geometry);
            drawTop(n, geometry);
            drawBottom(n, geometry);
            triangleStrips(n, geometry);

            //document.write("OUTPUT: " + geometry.vertices.length);

            //geometry.faces.push(new THREE.Face3(4,6,5,null,null,0));
            //geometry.faces.push(new THREE.Face3(4,7,6,null,null,0));


            /**
            geometry.vertices.push(new THREE.Vector3( 1.0,  1.0, -1.0));		//0
            geometry.vertices.push(new THREE.Vector3(-1.0, 1.0, -1.0));			//1
            geometry.vertices.push(new THREE.Vector3(-1.0, -1.0, -1.0));		//2
            geometry.vertices.push(new THREE.Vector3(1.0, -1.0, -1.0));			//3
            geometry.vertices.push(new THREE.Vector3(1.0, 1.0, 1.0));			//4
            geometry.vertices.push(new THREE.Vector3(-1.0, 1.0, 1.0));			//5
            geometry.vertices.push(new THREE.Vector3(-1.0, -1.0, 1.0));			//6
            geometry.vertices.push(new THREE.Vector3(1.0, -1.0, 1.0));			//7

            // Note: Face3( a, b, c, normal, color, materialIndex )
            // ACHTUNG DAS FOLGENDE DREIECK HAT FALSCHE ECKEN !!!
            geometry.faces.push(new THREE.Face3(1,0,2,null,null,0));
            geometry.faces.push(new THREE.Face3(3,2,0,null,null,0));

            geometry.faces.push(new THREE.Face3(4,5,6,null,null,1));
            geometry.faces.push(new THREE.Face3(6,7,4,null,null,1));

            geometry.faces.push(new THREE.Face3(0,4,3,null,null,2));
            geometry.faces.push(new THREE.Face3(7,3,4,null,null,2));

            geometry.faces.push(new THREE.Face3(5,1,2,null,null,3));
            geometry.faces.push(new THREE.Face3(2,6,5,null,null,3));

            geometry.faces.push(new THREE.Face3(0,1,5,null,null,4));
            geometry.faces.push(new THREE.Face3(5,4,0,null,null,4));

            geometry.faces.push(new THREE.Face3(6,2,3,null,null,5));
            geometry.faces.push(new THREE.Face3(7,6,3,null,null,5));
            */
            // And put the geometry and material together into a mesh
            cube = new THREE.Mesh(geometry,faceMaterial);

            // Turn it toward the scene, or we won't see the cube shape!
            cube.rotation.x = Math.PI / 5;
            cube.rotation.y = Math.PI / 5;


            // Add the cube to our scene
            scene.add( cube );

            // Add a mouse up handler to toggle the animation
            addMouseHandler();

            // Run our render loop
            run();
        }
        
        function drawCirclePoints(n, radius, center, geometry) {
            var s = (2 * Math.PI) / n;
            for (var i = 0; i < n; i++) {
                var t = s * i;
                var x = center.x + radius * Math.cos(t);
                var y = center.y + radius * Math.sin(t);
                //document.write(x + ";" + y + ";" + center.getComponent(2) + "  **********   ");
                geometry.vertices.push(new THREE.Vector3(x, y, center.getComponent(2)));
            }
            //document.write(geometry.vertices.length);
        }

        function drawTop(n, geometry) {
            for (let i = n-1; i > 0; i--) {
                geometry.faces.push(new THREE.Face3(0,i,i-1,null,null,3));
            }
            //document.write(geometry.faces.length);
        }

        function drawBottom(n, geometry) {
            for (let i = n; i < n*2-1; i++) {
                geometry.faces.push(new THREE.Face3(n, i, i+1, null, null, 3));
            }
            //geometry.faces.push(new THREE.Face3(7,11,12,null,null,3));
            //document.write(geometry.faces.length);
        }
        
        function triangleStrips(n, geometry) {
            var t, b;
            for (t = 0, b = n; t < n-1, b < n*2-1; t++, b++) {
                var tmp1 = t+1;
                var tmp2 = b+1;
                geometry.faces.push(new THREE.Face3(t,t+1,b,null,null,3));
                geometry.faces.push(new THREE.Face3(b+1,b,t+1,null,null,3));
                //document.write(t + "." + tmp1 + "." + b + "|" + tmp2 + "." + b + "." + tmp1 + " |||||| ");
            }
            geometry.faces.push(new THREE.Face3(n-1,0,n*2-1,null,null,3));
            geometry.faces.push(new THREE.Face3(n,n*2-1,0,null,null,3));

            /**/

           // geometry.faces.push(new THREE.Face3(15,1,31,null,null,1));
           // geometry.faces.push(new THREE.Face3(17,31,1,null,null,1));
        }

        /**
         * geometry.faces.push(new THREE.Face3(16,17,18,null,null,0));
         geometry.faces.push(new THREE.Face3(16,18,19,null,null,0));
         geometry.faces.push(new THREE.Face3(16,19,20,null,null,0));
         geometry.faces.push(new THREE.Face3(16,20,21,null,null,0));
         geometry.faces.push(new THREE.Face3(16,21,22,null,null,0));
         geometry.faces.push(new THREE.Face3(16,22,23,null,null,0));
         geometry.faces.push(new THREE.Face3(16,23,24,null,null,0));
         geometry.faces.push(new THREE.Face3(16,24,25,null,null,0));
         geometry.faces.push(new THREE.Face3(16,25,26,null,null,0));
         geometry.faces.push(new THREE.Face3(16,26,27,null,null,0));
         geometry.faces.push(new THREE.Face3(16,27,28,null,null,0));
         geometry.faces.push(new THREE.Face3(16,28,29,null,null,0));
         geometry.faces.push(new THREE.Face3(16,29,30,null,null,0));
         geometry.faces.push(new THREE.Face3(16,30,31,null,null,0));

        /**
         * geometry.faces.push(new THREE.Face3(0,15,14,null,null,0));
         geometry.faces.push(new THREE.Face3(0,14,13,null,null,0));
         geometry.faces.push(new THREE.Face3(0,13,12,null,null,0));
         geometry.faces.push(new THREE.Face3(0,12,11,null,null,0));
         geometry.faces.push(new THREE.Face3(0,11,10,null,null,0));
         geometry.faces.push(new THREE.Face3(0,10,9,null,null,0));
         geometry.faces.push(new THREE.Face3(0,9,8,null,null,0));
         geometry.faces.push(new THREE.Face3(0,8,7,null,null,0));
         geometry.faces.push(new THREE.Face3(0,7,6,null,null,0));
         geometry.faces.push(new THREE.Face3(0,6,5,null,null,0));
         geometry.faces.push(new THREE.Face3(0,5,4,null,null,0));
         geometry.faces.push(new THREE.Face3(0,4,3,null,null,0));
         geometry.faces.push(new THREE.Face3(0,3,2,null,null,0));
         geometry.faces.push(new THREE.Face3(0,2,1,null,null,0));

        /**
         * geometry.vertices.push(v);
         var x = parseInt(v.getComponent(0));
         var y = parseInt(v.getComponent(1));
         for (var i = run; i <= n; i++) {
                var theta = (i / n) * Math.PI * 2;
                geometry.vertices.push(new THREE.Vector3(x + Math.cos(theta) * radius, y + Math.sin(theta) * radius, v.getComponent(2)));
                //geometry.faces.push(new THREE.Face3(v,i-1,i,null,null,0));
                if (i == run) {
                    geometry.faces.push(new THREE.Face3(v,i,n,null,null,0));
                    //document.write(n + "..." + i + "   <--->   ");
                } else {
                    geometry.faces.push(new THREE.Face3(v,i,i-1,null,null,0));
                    //document.write(i + "." + i-1 + "   <--->   ");
                }
                if (i == n-1) {
                    //geometry.faces.push(new THREE.Face3(v,i+1,1,null,null,0));
                }
            }
         */

        function run()
        {
            // Render the scene
            renderer.render( scene, camera );

            // Spin the cube for next frame
            if (animating)
            {
                if (yrot) cube.rotation.y -= 0.05; else cube.rotation.x -= 0.05;
            }

            // Ask for another frame
            requestAnimationFrame(run);
        }

        function addMouseHandler()
        {
            var dom = renderer.domElement;

            dom.addEventListener( 'mouseup', onMouseUp, false);
        }

        function onMouseUp	(event)
        {
            event.preventDefault();

            animating = !animating;

            if (animating) yrot = !yrot;
        }

    </script>

</head>
<body onLoad="onLoad();" style="">
<center><h1>Simon Trumm (120099)</h1></center>
<div id="container" style="width:95%; height:80%; position:absolute;"></div>
<div id="prompt" style="width:95%; height:6%; bottom:0; text-align:center; position:absolute;">Click to animate the cube</div>

</body>
</html>
