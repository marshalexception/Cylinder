<!DOCTYPE html>
<html>
<head>
    <title>Welcome to WebGL</title>

    <link rel="stylesheet" href="../css/webglbook.css" />
    <script src="three.min.js"></script>
    <script src="RequestAnimationFrame.js"></script>
    <script>

        var renderer = null,
            scene = null,
            camera = null,
            cube = null,
            animating = false,
            yrot = false;

        function onLoad()
        {
            // Grab our container div
            var container = document.getElementById("container");

            // Create the Three.js renderer, add it to our div
            renderer = new THREE.WebGLRenderer( { antialias: true } );
            renderer.setSize(container.offsetWidth, container.offsetHeight);
            container.appendChild( renderer.domElement );

            // Create a new Three.js scene
            scene = new THREE.Scene();

            // Put in a camera
            camera = new THREE.PerspectiveCamera( 45, container.offsetWidth / container.offsetHeight, 1, 4000 );
            camera.position.set( 0, 0, 5 );
            camera.fov = 100;
            camera.updateProjectionMatrix();

            // Create a directional light to show off the object
            var light = new THREE.DirectionalLight( 0xffffff, 1.5);
            light.position.set(0, 0, 1);
            scene.add( light );

            // Create a colored cube and add it to the scene

            // First, create a MeshFaceMaterial for coloring each face
            var mats = [];
            mats.push(new THREE.MeshBasicMaterial({ color: 0x009e60  }));
            mats.push(new THREE.MeshBasicMaterial({ color: 0x0051ba  }));
            mats.push(new THREE.MeshBasicMaterial({ color: 0xffd500  }));
            mats.push(new THREE.MeshBasicMaterial({ color: 0xff5800  }));
            mats.push(new THREE.MeshBasicMaterial({ color: 0xC41E3A }));
            mats.push(new THREE.MeshBasicMaterial({ color: 0xffffff  }));
            var faceMaterial = new THREE.MeshFaceMaterial(mats);


            // Create the cube geometry by hand

            var geometry = new THREE.Geometry();

            //Gesamth√∂he: height * m
            var h = 1;
            var radius = 2;
            var n = 16;
            var m = 4;
            var height = h*m;

            //J
            var j = new THREE.Vector3(0,0,0);
            //j.set(0,0,0);
            triangleFan(j, radius, n, geometry, 1);

            //A
            var a = new THREE.Vector3(1,1,0);
            triangleFan(a, radius, n, geometry, 6);

            /**
            var centres = generateCentres(m,h);
            var circles = [];

            for (var i = 0; i < m; i++) {
                circles.push(getCircleCoordinates(centres[i], radius, n));
            }

            geometry = drawCircle(centres[0], circles[0]);                                   //Oberseite
            //drawCircle(centres[centres.length-1], circles[circles.length-1], geometry);     //Unterseite

            */
            // And put the geometry and material together into a mesh
            cube = new THREE.Mesh(geometry,faceMaterial);

            //var sphereAxis = new THREE.AxesHelper(20);
            //cube.add(sphereAxis);

            // Turn it toward the scene, or we won't see the cube shape!
            cube.rotation.x = Math.PI / 5;
            cube.rotation.y = Math.PI / 5;


            // Add the cube to our scene
            scene.add( cube );

            // Add a mouse up handler to toggle the animation
            addMouseHandler();

            // Run our render loop
            run();
        }

        function generateCentres(m,h) {
            let result = [];
            for (var i = 0; i < m; i++) {
                result.push(new THREE.Vector3(0,0,i*h));
            }
            return result;
        }

        function getCircleCoordinates(v, radius, n) {
            var result = [];
            var x = parseInt(v.getComponent(0));
            var y = parseInt(v.getComponent(1));
            for (var i = 1; i <= n; i++) {
                var theta = (i / n) * Math.PI * 2;
                result.push(new THREE.Vector3(x + Math.cos(theta) * radius, y + Math.sin(theta) * radius, v.getComponent(2)));
                //geometry.faces.push(new THREE.Face3(v,i-1,i,null,null,0));
                if (i == n-1) {
                   // geometry.faces.push(new THREE.Face3(v,i+1,1,null,null,0));
                }
            }

            return result;
        }
        
        function drawCircle(center, circle) {
            var result = new THREE.Geometry();
            result.vertices.push(center);
            for (var i = 0; i < circle.length; i++) {
                result.vertices.push(circle[i]);
            }
            for (var i = 0; i < circle.length; i++) {
                if (i == circle.length-1) {
                    //document.write(center + "." + circle[0] + "." + circle[i] + "   <--->   ");
                    result.faces.push(new THREE.Face3(center, circle[0], circle[i], null, null, 3));
                } else {
                    //document.write(center + "." + circle[i] + "." + circle[i + 1] + "   <--->   ");
                    result.faces.push(new THREE.Face3(center, circle[i], circle[i + 1], null, null, 3));
                }
            }
            //document.write(geometry.faces.length);
            /**
            for (var i = 1; i <= circle.length; i++) {
                geometry.vertices.push(circle[i].getComponent(0), circle[i].getComponent(1), circle[i].getComponent(2));
                if (i == n-1) {
                    geometry.faces.push(new THREE.Face3(center, circle[i+1], circle[1], null, null, 3));
                } else {
                    geometry.faces.push(new THREE.Face3(center, circle[i - 1], circle[i], null, null, 3));
                }
            }
             */
            return result;
        }

        function triangleFan(v, radius, n, geometry, run) {
            geometry.vertices.push(v);
            var x = parseInt(v.getComponent(0));
            var y = parseInt(v.getComponent(1));
            for (var i = run; i <= n; i++) {
                var theta = (i / n) * Math.PI * 2;
                geometry.vertices.push(new THREE.Vector3(x + Math.cos(theta) * radius, y + Math.sin(theta) * radius, v.getComponent(2)));
                //geometry.faces.push(new THREE.Face3(v,i-1,i,null,null,0));
                if (i == run) {
                    geometry.faces.push(new THREE.Face3(v,i,n,null,null,0));
                    //document.write(n + "..." + i + "   <--->   ");
                } else {
                    geometry.faces.push(new THREE.Face3(v,i,i-1,null,null,0));
                    //document.write(i + "." + i-1 + "   <--->   ");
                }
                if (i == n-1) {
                    //geometry.faces.push(new THREE.Face3(v,i+1,1,null,null,0));
                }
            }
        }

        function run()
        {
            // Render the scene
            renderer.render( scene, camera );

            // Spin the cube for next frame
            if (animating)
            {
                if (yrot) cube.rotation.y -= 0.05; else cube.rotation.x -= 0.05;
            }

            // Ask for another frame
            requestAnimationFrame(run);
        }

        function addMouseHandler()
        {
            var dom = renderer.domElement;

            dom.addEventListener( 'mouseup', onMouseUp, false);
        }

        function onMouseUp	(event)
        {
            event.preventDefault();

            animating = !animating;

            if (animating) yrot = !yrot;
        }

    </script>

</head>
<body onLoad="onLoad();" style="">
<center><h1>Simon Trumm (120099)</h1></center>
<div id="container" style="width:95%; height:80%; position:absolute;"></div>
<div id="prompt" style="width:95%; height:6%; bottom:0; text-align:center; position:absolute;">Click to animate the cube</div>

</body>
</html>
